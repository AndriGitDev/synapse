import { AgentSession } from '@/lib/types';

// Demo session: An AI agent debugging an API issue
export const debuggingApiSession: AgentSession = {
  id: 'demo-debugging-api',
  name: 'Debugging a 500 Error',
  description: 'Watch an AI agent diagnose and fix a production API bug',
  agent: 'clawdbot',
  startedAt: new Date('2026-02-07T14:00:00Z'),
  events: [
    {
      id: 'd1',
      timestamp: new Date('2026-02-07T14:00:00Z'),
      type: 'user_message',
      content: 'The /api/users endpoint is returning 500 errors in production. Can you investigate?',
    },
    {
      id: 'd2',
      timestamp: new Date('2026-02-07T14:00:01Z'),
      type: 'thought',
      content: 'A 500 error on /api/users suggests a server-side issue. I should check the logs first, then the code.',
      parentId: 'd1',
    },
    {
      id: 'd3',
      timestamp: new Date('2026-02-07T14:00:02Z'),
      type: 'tool_call',
      content: 'Checking recent error logs for the API',
      metadata: { tool: 'exec', duration: 1200 },
      parentId: 'd2',
    },
    {
      id: 'd4',
      timestamp: new Date('2026-02-07T14:00:03Z'),
      type: 'tool_result',
      content: 'TypeError: Cannot read property "email" of undefined at /api/users.ts:45',
      metadata: { success: true },
      parentId: 'd3',
    },
    {
      id: 'd5',
      timestamp: new Date('2026-02-07T14:00:04Z'),
      type: 'thought',
      content: 'Found it! There\'s a TypeError at line 45 in users.ts. The code is trying to access "email" on an undefined object. Let me look at the code.',
      parentId: 'd4',
    },
    {
      id: 'd6',
      timestamp: new Date('2026-02-07T14:00:05Z'),
      type: 'file_read',
      content: 'Reading the users API route to understand the issue',
      metadata: { file: 'src/app/api/users/route.ts', tool: 'read' },
      parentId: 'd5',
    },
    {
      id: 'd7',
      timestamp: new Date('2026-02-07T14:00:06Z'),
      type: 'thought',
      content: 'I see the issue. Line 45 accesses user.email but user can be null when the database query returns no results. Need to add a null check.',
      parentId: 'd6',
    },
    {
      id: 'd8',
      timestamp: new Date('2026-02-07T14:00:07Z'),
      type: 'decision',
      content: 'I\'ll add proper null checking and return a 404 when user is not found instead of crashing.',
      parentId: 'd7',
    },
    {
      id: 'd9',
      timestamp: new Date('2026-02-07T14:00:08Z'),
      type: 'file_write',
      content: 'Adding null check and proper error handling',
      metadata: { file: 'src/app/api/users/route.ts', tool: 'edit' },
      parentId: 'd8',
    },
    {
      id: 'd10',
      timestamp: new Date('2026-02-07T14:00:09Z'),
      type: 'tool_result',
      content: 'Successfully updated route.ts with null check',
      metadata: { success: true },
      parentId: 'd9',
    },
    {
      id: 'd11',
      timestamp: new Date('2026-02-07T14:00:10Z'),
      type: 'tool_call',
      content: 'Running the test suite to verify the fix',
      metadata: { tool: 'exec', duration: 3500 },
      parentId: 'd10',
    },
    {
      id: 'd12',
      timestamp: new Date('2026-02-07T14:00:14Z'),
      type: 'tool_result',
      content: 'All 24 tests passed ✓',
      metadata: { success: true },
      parentId: 'd11',
    },
    {
      id: 'd13',
      timestamp: new Date('2026-02-07T14:00:15Z'),
      type: 'thought',
      content: 'Tests pass. Now I should also add a test case specifically for the null user scenario to prevent regression.',
      parentId: 'd12',
    },
    {
      id: 'd14',
      timestamp: new Date('2026-02-07T14:00:16Z'),
      type: 'file_write',
      content: 'Adding regression test for null user case',
      metadata: { file: 'src/app/api/users/__tests__/route.test.ts', tool: 'write' },
      parentId: 'd13',
    },
    {
      id: 'd15',
      timestamp: new Date('2026-02-07T14:00:17Z'),
      type: 'tool_call',
      content: 'Running tests again to confirm new test passes',
      metadata: { tool: 'exec', duration: 2800 },
      parentId: 'd14',
    },
    {
      id: 'd16',
      timestamp: new Date('2026-02-07T14:00:20Z'),
      type: 'tool_result',
      content: 'All 25 tests passed ✓',
      metadata: { success: true },
      parentId: 'd15',
    },
    {
      id: 'd17',
      timestamp: new Date('2026-02-07T14:00:21Z'),
      type: 'decision',
      content: 'Fix is complete and tested. Creating a commit with clear message.',
      parentId: 'd16',
    },
    {
      id: 'd18',
      timestamp: new Date('2026-02-07T14:00:22Z'),
      type: 'tool_call',
      content: 'Committing the fix',
      metadata: { tool: 'exec', duration: 500 },
      parentId: 'd17',
    },
    {
      id: 'd19',
      timestamp: new Date('2026-02-07T14:00:23Z'),
      type: 'tool_result',
      content: '[main a1b2c3d] fix: handle null user in /api/users endpoint',
      metadata: { success: true },
      parentId: 'd18',
    },
    {
      id: 'd20',
      timestamp: new Date('2026-02-07T14:00:24Z'),
      type: 'assistant_message',
      content: 'Fixed! The issue was a missing null check at line 45. When the database returned no user, the code tried to access user.email on undefined. I\'ve added proper null handling that returns a 404 instead of crashing, plus a regression test. Committed as a1b2c3d.',
      parentId: 'd19',
    },
  ],
};
